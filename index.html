<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Andrey Esipov — A 3D World</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #071019;
      --teal: #49e6d6;
      --warm: #ffb86b;
      --light: #e9f2ff;
      --muted: rgba(233,242,255,.7);
    }
    * { box-sizing: border-box; }
    html, body {
      margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: var(--bg);
      font-family: 'Space Grotesk', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color: var(--light);
    }
    #scene { position: fixed; inset: 0; width: 100%; height: 100%; display: block; }

    .hud {
      position: fixed; inset: 0; pointer-events: none; display: flex; align-items: center; justify-content: center;
    }
    .card {
      position: absolute; left: 6vw; bottom: 8vh; max-width: 480px;
      padding: 18px 22px; border-radius: 18px;
      background: rgba(6, 12, 20, 0.6); backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: 0 16px 40px rgba(0,0,0,.35);
      opacity: 0; transform: translateY(12px); transition: all .6s ease;
      pointer-events: auto;
    }
    .card.active { opacity: 1; transform: translateY(0); }
    .card h1 { font-size: 34px; margin: 0 0 8px; letter-spacing: .2px; }
    .card h2 { font-size: 22px; margin: 0 0 8px; color: var(--teal); font-weight: 600; }
    .card p { margin: 6px 0; color: var(--muted); line-height: 1.5; }
    .card a { color: var(--teal); text-decoration: none; border-bottom: 1px solid rgba(73,230,214,.4); }

    .nav {
      position: fixed; right: 24px; top: 50%; transform: translateY(-50%);
      display: flex; flex-direction: column; gap: 10px; pointer-events: auto;
    }
    .dot {
      width: 12px; height: 12px; border-radius: 50%; border: 2px solid rgba(255,255,255,.45);
      background: rgba(255,255,255,.15); cursor: pointer; transition: all .3s;
    }
    .dot.active { background: var(--teal); border-color: var(--teal); box-shadow: 0 0 12px rgba(73,230,214,.8); }

    .controls {
      position: fixed; left: 6vw; top: 6vh; display: flex; gap: 10px; pointer-events: auto;
    }
    .btn {
      padding: 10px 14px; border-radius: 999px; border: 1px solid rgba(255,255,255,.1);
      background: rgba(6,12,20,.6); color: var(--light); cursor: pointer; font-weight: 600;
      transition: all .3s; user-select: none;
    }
    .btn:hover { transform: translateY(-1px); border-color: rgba(255,255,255,.3); }

    .progress {
      position: fixed; left: 6vw; bottom: 4vh; font-size: 13px; color: var(--muted);
    }

    .hint {
      position: fixed; right: 24px; bottom: 24px; font-size: 12px; color: var(--muted);
      background: rgba(6,12,20,.5); padding: 8px 10px; border-radius: 8px;
      border: 1px solid rgba(255,255,255,.08);
    }

    @media (max-width: 768px) {
      .card { left: 5vw; right: 5vw; max-width: none; }
      .nav { right: 12px; }
      .controls { top: 12px; left: 12px; }
      .card h1 { font-size: 28px; }
      .card h2 { font-size: 18px; }
    }
  </style>
</head>
<body>
  <canvas id="scene"></canvas>

  <div class="hud">
    <div class="card" id="card">
      <h1 id="title">Hi, I'm Andrey</h1>
      <h2 id="subtitle">A builder of systems, products, and endurance.</h2>
      <p id="body">Welcome to my 3D world. Scroll or use the arrows to travel through the chapters.</p>
      <div id="links"></div>
    </div>
  </div>

  <div class="controls">
    <div class="btn" id="prev">◀ Back</div>
    <div class="btn" id="next">Next ▶</div>
  </div>

  <div class="nav" id="nav"></div>
  <div class="progress" id="progress">Chapter 1 of 6</div>
  <div class="hint">Scroll / Swipe to travel</div>

  <script type="module">
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js';
    import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js';
    import { gsap } from 'https://cdn.jsdelivr.net/npm/gsap@3.12.5/index.js';

    const canvas = document.getElementById('scene');
    const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setClearColor(0x071019, 1);

    const scene = new THREE.Scene();
    scene.fog = new THREE.Fog(0x071019, 20, 120);

    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 300);
    camera.position.set(0, 6, 16);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enabled = false;

    // Lighting
    const ambient = new THREE.AmbientLight(0x9bb7ff, 0.4);
    scene.add(ambient);

    const dir = new THREE.DirectionalLight(0xffffff, 1.0);
    dir.position.set(10, 20, 10);
    dir.castShadow = false;
    scene.add(dir);

    const warm = new THREE.PointLight(0xffb86b, 0.9, 40);
    warm.position.set(-5, 6, 6);
    scene.add(warm);

    // Ground plane
    const ground = new THREE.Mesh(
      new THREE.PlaneGeometry(500, 500, 10, 10),
      new THREE.MeshStandardMaterial({ color: 0x0c1622, roughness: 0.9 })
    );
    ground.rotation.x = -Math.PI / 2;
    ground.position.y = -1.2;
    scene.add(ground);

    // Helper functions
    const palette = {
      teal: 0x49e6d6,
      blue: 0x1c2c3b,
      dark: 0x0d1219,
      warm: 0xffb86b,
      purple: 0x6b6bff,
      green: 0x7bd88f,
      gray: 0x98a6b8,
    };

    function makeTree(x, z, scale = 1) {
      const group = new THREE.Group();
      const trunk = new THREE.Mesh(
        new THREE.CylinderGeometry(0.2 * scale, 0.25 * scale, 1.2 * scale, 6),
        new THREE.MeshStandardMaterial({ color: 0x5c3b2e, roughness: 0.9 })
      );
      trunk.position.y = 0.6 * scale;
      const leaves = new THREE.Mesh(
        new THREE.ConeGeometry(0.8 * scale, 1.4 * scale, 6),
        new THREE.MeshStandardMaterial({ color: palette.green, roughness: 0.8 })
      );
      leaves.position.y = 1.6 * scale;
      group.add(trunk, leaves);
      group.position.set(x, -1.1, z);
      return group;
    }

    function makeHouse() {
      const group = new THREE.Group();
      const base = new THREE.Mesh(
        new THREE.BoxGeometry(4.4, 2.6, 3.4),
        new THREE.MeshStandardMaterial({ color: 0x1b2733, roughness: 0.8 })
      );
      base.position.y = 0.1;
      const roof = new THREE.Mesh(
        new THREE.ConeGeometry(3.6, 1.6, 4),
        new THREE.MeshStandardMaterial({ color: palette.warm, roughness: 0.7 })
      );
      roof.position.y = 2.1;
      roof.rotation.y = Math.PI / 4;
      const door = new THREE.Mesh(
        new THREE.BoxGeometry(0.7, 1.2, 0.1),
        new THREE.MeshStandardMaterial({ color: palette.teal })
      );
      door.position.set(0, -0.2, 1.75);
      group.add(base, roof, door);
      return group;
    }

    function makeDesk() {
      const group = new THREE.Group();
      const desk = new THREE.Mesh(
        new THREE.BoxGeometry(3.8, 0.4, 1.6),
        new THREE.MeshStandardMaterial({ color: 0x1f2c3b, roughness: 0.7 })
      );
      desk.position.y = 0.2;
      const legs = new THREE.Mesh(
        new THREE.BoxGeometry(3.6, 1.1, 1.4),
        new THREE.MeshStandardMaterial({ color: 0x131b24, roughness: 0.7 })
      );
      legs.position.y = -0.5;
      const screen = new THREE.Mesh(
        new THREE.BoxGeometry(1.6, 1, 0.1),
        new THREE.MeshStandardMaterial({ color: palette.teal, emissive: palette.teal, emissiveIntensity: 0.6 })
      );
      screen.position.set(0, 1.1, -0.4);
      const screen2 = screen.clone();
      screen2.position.set(1.6, 0.9, -0.5);
      screen2.scale.set(0.8, 0.7, 0.8);
      group.add(desk, legs, screen, screen2);
      return group;
    }

    function makeNeuralCluster(count = 12) {
      const group = new THREE.Group();
      for (let i = 0; i < count; i++) {
        const node = new THREE.Mesh(
          new THREE.SphereGeometry(0.15, 10, 10),
          new THREE.MeshStandardMaterial({ color: palette.purple, emissive: palette.purple, emissiveIntensity: 0.7 })
        );
        node.position.set((Math.random() - 0.5) * 2.6, Math.random() * 1.8 + 0.2, (Math.random() - 0.5) * 2.6);
        group.add(node);
      }
      return group;
    }

    function makeCandles() {
      const group = new THREE.Group();
      for (let i = 0; i < 10; i++) {
        const height = Math.random() * 2 + 0.6;
        const candle = new THREE.Mesh(
          new THREE.BoxGeometry(0.3, height, 0.3),
          new THREE.MeshStandardMaterial({ color: palette.teal, emissive: 0x1e99a7, emissiveIntensity: 0.4 })
        );
        candle.position.set(i * 0.5 - 2.2, height / 2 - 0.6, (Math.random() - 0.5) * 1.2);
        group.add(candle);
      }
      return group;
    }

    function makeMountain(offsetX) {
      const mountain = new THREE.Mesh(
        new THREE.ConeGeometry(4, 6, 6),
        new THREE.MeshStandardMaterial({ color: 0x112433, roughness: 0.9 })
      );
      mountain.position.set(offsetX, 1, -4);
      return mountain;
    }

    function makeWater() {
      const water = new THREE.Mesh(
        new THREE.CircleGeometry(4, 18),
        new THREE.MeshStandardMaterial({ color: 0x0d3653, roughness: 0.3, metalness: 0.2 })
      );
      water.rotation.x = -Math.PI / 2;
      water.position.y = -1.1;
      return water;
    }

    function makeSwingSet() {
      const group = new THREE.Group();
      const frameMat = new THREE.MeshStandardMaterial({ color: 0x273241, roughness: 0.8 });
      const leg1 = new THREE.Mesh(new THREE.BoxGeometry(0.2, 2, 0.2), frameMat);
      leg1.position.set(-0.8, 0.0, 0);
      leg1.rotation.z = Math.PI / 12;
      const leg2 = leg1.clone();
      leg2.position.x = 0.8;
      leg2.rotation.z = -Math.PI / 12;
      const top = new THREE.Mesh(new THREE.BoxGeometry(2, 0.2, 0.2), frameMat);
      top.position.y = 1.0;
      const seat = new THREE.Mesh(new THREE.BoxGeometry(0.6, 0.08, 0.25), new THREE.MeshStandardMaterial({ color: palette.warm }));
      seat.position.y = -0.2;
      group.add(leg1, leg2, top, seat);
      return group;
    }

    function makeMailbox() {
      const group = new THREE.Group();
      const post = new THREE.Mesh(new THREE.BoxGeometry(0.2, 1.4, 0.2), new THREE.MeshStandardMaterial({ color: 0x1b2835 }));
      post.position.y = 0.2;
      const box = new THREE.Mesh(new THREE.BoxGeometry(1.1, 0.5, 0.6), new THREE.MeshStandardMaterial({ color: palette.teal, emissive: palette.teal, emissiveIntensity: 0.4 }));
      box.position.set(0.4, 0.8, 0);
      group.add(post, box);
      return group;
    }

    // Locations
    const locations = [];

    function addLocation(name, position) {
      const group = new THREE.Group();
      group.position.copy(position);
      scene.add(group);
      locations.push({ name, group });
      return group;
    }

    // 1. Home
    const home = addLocation('Home', new THREE.Vector3(0, 0, 0));
    home.add(makeHouse());
    for (let i = 0; i < 7; i++) {
      home.add(makeTree(-6 + i * 2, -4 + Math.random() * 4, 1 + Math.random() * 0.4));
    }

    // Firefly particles
    const fireflies = new THREE.Group();
    const fireflyGeom = new THREE.SphereGeometry(0.05, 6, 6);
    for (let i = 0; i < 40; i++) {
      const fly = new THREE.Mesh(
        fireflyGeom,
        new THREE.MeshStandardMaterial({ color: palette.warm, emissive: palette.warm, emissiveIntensity: 1 })
      );
      fly.position.set((Math.random() - 0.5) * 8, Math.random() * 3 + 0.5, (Math.random() - 0.5) * 6);
      fireflies.add(fly);
    }
    home.add(fireflies);

    // 2. Office
    const office = addLocation('Office', new THREE.Vector3(28, 0, -6));
    office.add(makeDesk());
    const nodes = makeNeuralCluster();
    nodes.position.set(0, 0.3, 2.4);
    office.add(nodes);
    const floatingPanel = new THREE.Mesh(
      new THREE.BoxGeometry(2.8, 1.4, 0.1),
      new THREE.MeshStandardMaterial({ color: 0x1d3f51, emissive: 0x2dcfe0, emissiveIntensity: 0.4 })
    );
    floatingPanel.position.set(-2.4, 1.5, -0.8);
    office.add(floatingPanel);

    // 3. Trading Floor
    const trading = addLocation('Trading', new THREE.Vector3(56, 0, 8));
    const candles = makeCandles();
    trading.add(candles);
    const chartBase = new THREE.Mesh(
      new THREE.BoxGeometry(6, 0.3, 3),
      new THREE.MeshStandardMaterial({ color: 0x16202b, roughness: 0.6 })
    );
    chartBase.position.y = -0.6;
    trading.add(chartBase);
    const stream = new THREE.TorusKnotGeometry(1.8, 0.2, 60, 8);
    const streamMesh = new THREE.Mesh(stream, new THREE.MeshStandardMaterial({ color: palette.teal, emissive: palette.teal, emissiveIntensity: 0.3 }));
    streamMesh.position.set(0, 1.2, -1.6);
    trading.add(streamMesh);

    // 4. Outdoors
    const outdoors = addLocation('Outdoors', new THREE.Vector3(84, 0, -6));
    outdoors.add(makeMountain(-2.5));
    outdoors.add(makeMountain(3.5));
    const trail = new THREE.Mesh(
      new THREE.BoxGeometry(10, 0.2, 2.4),
      new THREE.MeshStandardMaterial({ color: 0x172532, roughness: 0.9 })
    );
    trail.position.set(0, -0.9, 3);
    outdoors.add(trail);
    const water = makeWater();
    water.position.set(-4.5, -1.05, 2.5);
    outdoors.add(water);

    // 5. Backyard
    const backyard = addLocation('Backyard', new THREE.Vector3(112, 0, 6));
    const house2 = makeHouse();
    house2.scale.set(0.8, 0.8, 0.8);
    house2.position.set(-2, 0, -2);
    backyard.add(house2);
    backyard.add(makeSwingSet());
    backyard.add(makeTree(2.8, 3, 1.1));
    backyard.add(makeTree(-5, 2.6, 0.9));

    // 6. Mailbox
    const mailbox = addLocation('Mailbox', new THREE.Vector3(140, 0, -2));
    const box = makeMailbox();
    mailbox.add(box);
    const beacon = new THREE.Mesh(
      new THREE.SphereGeometry(0.6, 16, 16),
      new THREE.MeshStandardMaterial({ color: palette.warm, emissive: palette.warm, emissiveIntensity: 0.7 })
    );
    beacon.position.set(1.4, 1.6, 0);
    mailbox.add(beacon);

    // Road/path
    const path = new THREE.Mesh(
      new THREE.BoxGeometry(150, 0.2, 6),
      new THREE.MeshStandardMaterial({ color: 0x0f1a27, roughness: 1 })
    );
    path.position.set(70, -1.1, 0);
    scene.add(path);

    // Camera waypoints
    const chapters = [
      {
        title: "Hi, I'm Andrey",
        subtitle: "A builder of systems, products, and endurance.",
        body: "Welcome to my 3D world. Scroll or use the arrows to travel through the chapters.",
        links: "",
        camPos: new THREE.Vector3(0, 6, 16),
        camLook: new THREE.Vector3(0, 1.5, 0),
      },
      {
        title: "The Office",
        subtitle: "Principal PM at Microsoft — building AI into OneDrive",
        body: "Driving Copilot integration, semantic search, and experiences that make AI accessible to everyone.",
        links: "",
        camPos: new THREE.Vector3(26, 6, 14),
        camLook: new THREE.Vector3(28, 1.2, -4),
      },
      {
        title: "The Trading Floor",
        subtitle: "Running a quantitative trading business",
        body: "Systematic strategies, algorithms, and data-driven edge — where research meets execution.",
        links: "",
        camPos: new THREE.Vector3(54, 6, 18),
        camLook: new THREE.Vector3(56, 0.6, 8),
      },
      {
        title: "The Outdoors",
        subtitle: "Endurance, adventure, and the edge of possibility",
        body: "Top 10 at Norseman. Ironman. SwimRun World Championship — always chasing the next horizon.",
        links: "",
        camPos: new THREE.Vector3(84, 8, 16),
        camLook: new THREE.Vector3(84, 1.2, -4),
      },
      {
        title: "The Backyard",
        subtitle: "Franklin, Tennessee. Dad of 3.",
        body: "Building a warm, grounded life — curiosity, family, and community at the center.",
        links: "",
        camPos: new THREE.Vector3(110, 6, 16),
        camLook: new THREE.Vector3(112, 1.2, 6),
      },
      {
        title: "The Mailbox",
        subtitle: "Let’s connect",
        body: "Reach out or explore my work across platforms.",
        links: "<p><a href='https://github.com/andrey-esipov' target='_blank'>GitHub</a> · <a href='https://linkedin.com/in/andrey-esipov' target='_blank'>LinkedIn</a></p>",
        camPos: new THREE.Vector3(138, 5.5, 12),
        camLook: new THREE.Vector3(140, 0.8, -2),
      }
    ];

    const card = document.getElementById('card');
    const titleEl = document.getElementById('title');
    const subtitleEl = document.getElementById('subtitle');
    const bodyEl = document.getElementById('body');
    const linksEl = document.getElementById('links');
    const progress = document.getElementById('progress');
    const nav = document.getElementById('nav');

    let current = 0;
    let isAnimating = false;

    function updateCard(index) {
      const chapter = chapters[index];
      titleEl.textContent = chapter.title;
      subtitleEl.textContent = chapter.subtitle;
      bodyEl.textContent = chapter.body;
      linksEl.innerHTML = chapter.links || '';
      card.classList.add('active');
      progress.textContent = `Chapter ${index + 1} of ${chapters.length}`;
      document.querySelectorAll('.dot').forEach((dot, i) => {
        dot.classList.toggle('active', i === index);
      });
    }

    function moveTo(index) {
      if (index < 0 || index >= chapters.length || isAnimating) return;
      isAnimating = true;
      current = index;
      card.classList.remove('active');
      const { camPos, camLook } = chapters[index];
      gsap.to(camera.position, {
        duration: 1.8,
        x: camPos.x, y: camPos.y, z: camPos.z,
        ease: 'power2.inOut',
        onUpdate: () => camera.lookAt(camLook),
        onComplete: () => {
          camera.lookAt(camLook);
          updateCard(index);
          isAnimating = false;
        }
      });
    }

    chapters.forEach((chapter, i) => {
      const dot = document.createElement('div');
      dot.className = 'dot' + (i === 0 ? ' active' : '');
      dot.addEventListener('click', () => moveTo(i));
      nav.appendChild(dot);
    });

    document.getElementById('next').addEventListener('click', () => moveTo(current + 1));
    document.getElementById('prev').addEventListener('click', () => moveTo(current - 1));

    let scrollLock = false;
    window.addEventListener('wheel', (e) => {
      if (scrollLock) return;
      scrollLock = true;
      if (e.deltaY > 0) moveTo(current + 1); else moveTo(current - 1);
      setTimeout(() => scrollLock = false, 900);
    }, { passive: true });

    // Touch swipe
    let touchStartY = 0;
    window.addEventListener('touchstart', (e) => touchStartY = e.touches[0].clientY, { passive: true });
    window.addEventListener('touchend', (e) => {
      const delta = e.changedTouches[0].clientY - touchStartY;
      if (Math.abs(delta) > 40) {
        if (delta < 0) moveTo(current + 1); else moveTo(current - 1);
      }
    }, { passive: true });

    // Animate elements
    const clock = new THREE.Clock();
    function animate() {
      const t = clock.getElapsedTime();
      fireflies.children.forEach((fly, i) => {
        fly.position.y += Math.sin(t * 1.4 + i) * 0.002;
      });
      nodes.children.forEach((node, i) => {
        node.position.y += Math.sin(t * 1.2 + i) * 0.0015;
      });
      streamMesh.rotation.x += 0.004;
      streamMesh.rotation.y += 0.003;
      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    }

    updateCard(0);
    animate();

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    });
  </script>
</body>
</html>
